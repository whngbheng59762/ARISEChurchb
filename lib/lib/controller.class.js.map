{"version":3,"sources":["../../src/lib/controller.class.js"],"names":["Controller","ctx","next","arguments","length","Error","hook","name","get","set","value","wrap","bind","method","toUpperCase","data","body","msg","code","view","json","file","filename","relative","dirname","createReadStream","path","args"],"mappings":"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","file":"controller.class.js","sourcesContent":["import fs from \"fs\";\nimport co from \"co\";\nimport path from \"path\";\nimport Parameter from \"parameter\";\nimport Hook from \"./../lib/hook.class\";\nimport {runAction} from \"./../util/http.util\";\nimport {isGeneratorFunction} from \"./../util/default.util\";\n\nexport default class Controller {\n\n    constructor(ctx, next) {\n\n        if (arguments.length == 0) {\n            throw new Error('SyntaxError: missing super(ctx) call in constructor');\n            return;\n        }\n        if (arguments.length == 1) {\n            throw new Error('SyntaxError: missing super(next) call in constructor');\n            return;\n        }\n\n        this.ctx = ctx;\n        this.next = next;\n        this.hook = new Hook(ctx, next);\n\n        for (let name in ctx) {\n            if (typeof ctx[name] !== 'function') {\n                Object.defineProperty(this, name, {\n                    get: () => {\n                        return this.ctx[name];\n                    },\n                    set: value => {\n                        this.ctx[name] = value;\n                    }\n                });\n            } else {\n                if (isGeneratorFunction(ctx[name])) {\n                    this[name] = co.wrap(ctx[name]).bind(ctx);\n                } else {\n                    this[name] = ctx[name];\n                }\n            }\n        }\n    }\n\n    get validate() {\n        return new Parameter();\n    }\n\n    isGet() {\n\n        if (this.ctx.method == 'GET') {\n            return true;\n        }\n        return false;\n    }\n\n    isPost() {\n\n        if (this.ctx.method == 'POST') {\n            return true;\n        }\n        return false;\n    }\n\n    isAjax() {\n        return this.ctx.get('X-Requested-With') === 'XMLHttpRequest';\n    }\n\n    isPjax() {\n        return this.ctx.get('X-PJAX') || false;\n    }\n\n    isMethod(method) {\n        return this.ctx.method === method.toUpperCase();\n    }\n\n    view(data) {\n        this.ctx.body = data;\n    }\n\n    json(data, msg, code) {\n\n        let body = {};\n\n        switch (arguments.length) {\n            case 1:\n                body = {\n                    data: data,\n                }\n                break;\n            case 2:\n                body = {\n                    data: data,\n                    msg: msg,\n                }\n                break;\n            case 3:\n                body = {\n                    data: data,\n                    msg: msg,\n                    code: code\n                }\n                break;\n        }\n\n        this.view(body);\n    }\n\n    success(data, msg) {\n        this.json(data, msg, 1);\n    }\n\n    error(data, msg) {\n        this.json(data, msg, 0);\n    }\n\n    download(file) {\n\n        const filename = path.relative(path.dirname(file), file);\n\n        this.ctx.set('Content-disposition', 'attachment; filename=' + filename);\n        this.view(fs.createReadStream(file));\n    }\n\n    async action(path, ...args) {\n        return await runAction(Object.assign(this.ctx, {path: path}), this.next, ...args);\n    }\n}"]}