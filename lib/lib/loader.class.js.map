{"version":3,"sources":["../../src/lib/loader.class.js"],"names":["options","loaders","Array","option","concat","loader","dir","resolve","process","cwd","exist","existsSync","files","readdirSync","list","file","statSync","isDirectory","walk","push","root","Error","suffix","prefix","filter","paths","forEach","value","index","_path","relative","lastIndexOf","slice","v","i","replace","lib","require","hasOwnProperty","length","default","arr1","arr2","arr","key"],"mappings":"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","file":"loader.class.js","sourcesContent":["import path from \"path\";\nimport fs from \"fs\";\n\nexport default class {\n\n    constructor(options) {\n\n        var loaders = [];\n\n        if (options instanceof Array) {\n            for (var option of options) {\n                loaders = this.concat(loaders, this.loader(option));\n            }\n        } else {\n            loaders = this.loader(options);\n        }\n\n        return loaders;\n    }\n\n    walk(dir) {\n\n        dir = path.resolve(process.cwd(), dir);\n\n        var exist = fs.existsSync(dir);\n        if (!exist) {\n            return;\n        }\n\n        var files = fs.readdirSync(dir);\n        var list = [];\n        for (var file of files) {\n            if (fs.statSync(dir + '/' + file).isDirectory()) {\n                list = list.concat(this.walk(dir + '/' + file));\n            } else {\n                list.push(dir + '/' + file);\n            }\n        }\n\n        return list;\n    }\n\n    loader(options) {\n\n        if (typeof options == 'undefined') {\n            options = {};\n        }\n\n        var loaders = [];\n        if (typeof options.root !== 'string') {\n            throw Error('root must be specified');\n        }\n\n        options.suffix = options.suffix || '.js';\n        options.prefix = options.prefix || '';\n        options.filter = options.filter || [];\n\n        var paths = this.walk(options.root);\n        if (!paths) {\n            return;\n        }\n\n        paths.forEach(function (value, index) {\n            var _path = path.relative(options.root, value);\n            if (_path.lastIndexOf(options.suffix) != -1) {\n                _path = _path.slice(0, _path.lastIndexOf(options.suffix));\n\n                options.filter.forEach(function (v, i) {\n                    _path = _path.replace(v, '');\n                });\n\n                _path = options.prefix + _path;\n\n                let lib = require(value);\n                if (lib.hasOwnProperty('default') && Object.keys(lib).length == 1) {\n                    loaders[_path] = lib.default;\n                } else {\n                    loaders[_path] = lib;\n                }\n            }\n        });\n\n        return loaders;\n    }\n\n    concat(arr1, arr2) {\n\n        var arr = arr1;\n\n        for (var key in arr2) {\n            arr[key] = arr2[key];\n        }\n\n        return arr;\n    }\n}\n"]}