{"version":3,"sources":["../../src/lib/hook.class.js"],"names":["hooks","name","action","add","key","push","get","path","test","runFunction","runAction","paths","split","length","_path","slice","lastIndexOf","include","_key","koahub","controllers","controller","property","prototype","filter","value","k","call","console","error","eval"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;AAGI,sBAAc;AAAA;;AACV,aAAKA,KAAL,GAAa,EAAb;AACH;;;;8BAEK;AACF,mBAAO,KAAKA,KAAZ;AACH;;;4BAEGC,I,EAAMC,M,EAAQ;AACd,gBAAIC,MAAM,IAAV;AACA,iBAAK,IAAIC,GAAT,IAAgB,KAAKJ,KAArB,EAA4B;AACxB,oBAAIC,QAAQG,GAAZ,EAAiB;AACb,yBAAKJ,KAAL,CAAWI,GAAX,EAAgBC,IAAhB,CAAqBH,MAArB;AACAC,0BAAM,KAAN;AACH;AACJ;AACD,gBAAIA,GAAJ,EAAS;AACL,qBAAKH,KAAL,CAAWC,IAAX,IAAmB,CAACC,MAAD,CAAnB;AACH;;AAED,mBAAO,KAAKI,GAAL,EAAP;AACH;;;4BAEGL,I,EAAM;AACN,iBAAK,IAAIG,GAAT,IAAgB,KAAKJ,KAArB,EAA4B;AACxB,oBAAIC,QAAQG,GAAZ,EAAiB;AAAA;AAAA;AAAA;;AAAA;AACb,wEAAiB,KAAKJ,KAAL,CAAWI,GAAX,CAAjB,4GAAkC;AAAA,gCAAzBG,IAAyB;;AAC9B,gCAAI,aAAaC,IAAb,CAAkBD,IAAlB,CAAJ,EAA6B;AACzB,qCAAKE,WAAL,CAAiBF,IAAjB;AACH,6BAFD,MAEO;AACH,qCAAKG,SAAL,CAAeH,IAAf;AACH;AACJ;AAPY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQhB;AACJ;AACJ;;;kCAESA,I,EAAM;AACZ,gBAAMI,QAAQJ,KAAKK,KAAL,CAAW,GAAX,CAAd;AACA,gBAAMV,SAASS,MAAMA,MAAME,MAAN,GAAe,CAArB,CAAf;AACA,gBAAMC,QAAQP,KAAKQ,KAAL,CAAW,CAAX,EAAcR,KAAKS,WAAL,CAAiB,GAAjB,CAAd,CAAd;;AAEA,gBAAIC,UAAU,KAAd;AACA,iBAAK,IAAIC,IAAT,IAAiBC,OAAOC,WAAxB,EAAqC;AACjC,oBAAIF,QAAQJ,KAAZ,EAAmB;AACfG,8BAAU,IAAV;AACA;AACH;AACJ;;AAED,gBAAIA,OAAJ,EAAa;AACT,oBAAII,aAAaF,OAAOC,WAAP,CAAmBN,KAAnB,CAAjB;AACA,oBAAIQ,WAAW,mCAA2BD,WAAWE,SAAtC,EAAiDC,MAAjD,CAAwD,UAAUC,KAAV,EAAiB;AACpF,wBAAIA,SAAS,aAAb,EAA4B;AACxB,+BAAO,KAAP;AACH;AACD,2BAAO,IAAP;AACH,iBALc,CAAf;;AAOA,qBAAK,IAAIC,CAAT,IAAcJ,QAAd,EAAwB;AACpB,wBAAIA,SAASI,CAAT,KAAexB,MAAnB,EAA2B;AACvB,sDAAsB,IAAImB,UAAJ,EAAtB,EAAwCC,SAASI,CAAT,CAAxC,EAAqDC,IAArD,CAA0D,IAA1D;AACA;AACH;AACJ;;AAEDC,wBAAQC,KAAR,CAAc,uBAAd;AACH,aAjBD,MAiBO;AACHD,wBAAQC,KAAR,CAAc,2BAAd;AACH;AACJ;;;oCAEWJ,K,EAAO;AACfK,mCAAqBL,KAArB;AACH","file":"hook.class.js","sourcesContent":["// hooks 定义\n// {\n//     addOrder: [\n//         '/admin/index/index'\n//     ]\n// }\n\nexport default class {\n    constructor() {\n        this.hooks = {};\n    }\n\n    get() {\n        return this.hooks;\n    }\n\n    add(name, action) {\n        let add = true;\n        for (let key in this.hooks) {\n            if (name == key) {\n                this.hooks[key].push(action);\n                add = false;\n            }\n        }\n        if (add) {\n            this.hooks[name] = [action];\n        }\n\n        return this.get();\n    }\n\n    run(name) {\n        for (let key in this.hooks) {\n            if (name == key) {\n                for (let path of this.hooks[key]) {\n                    if (/\\w+\\(.*\\)$/.test(path)) {\n                        this.runFunction(path);\n                    } else {\n                        this.runAction(path);\n                    }\n                }\n            }\n        }\n    }\n\n    runAction(path) {\n        const paths = path.split('/');\n        const action = paths[paths.length - 1];\n        const _path = path.slice(0, path.lastIndexOf('/'));\n\n        let include = false;\n        for (let _key in koahub.controllers) {\n            if (_key == _path) {\n                include = true;\n                break;\n            }\n        }\n\n        if (include) {\n            let controller = koahub.controllers[_path];\n            let property = Object.getOwnPropertyNames(controller.prototype).filter(function (value) {\n                if (value == 'constructor') {\n                    return false;\n                }\n                return true;\n            });\n\n            for (let k in property) {\n                if (property[k] == action) {\n                    Object.getPrototypeOf(new controller())[property[k]].call(this);\n                    return;\n                }\n            }\n\n            console.error('Hook Not Found Action');\n        } else {\n            console.error('Hook Not Found Controller');\n        }\n    }\n\n    runFunction(value) {\n        eval(`koahub.utils.${value}`);\n    }\n}\n"]}