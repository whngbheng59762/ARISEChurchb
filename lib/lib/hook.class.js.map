{"version":3,"sources":["../../src/lib/hook.class.js"],"names":["hooks","name","action","add","key","push","get","path","test","runFunction","runController","slice","lastIndexOf","include","_key","koahub","controllers","ctrl","pros","prototype","filter","value","callFlag","k","call","console","error","eval"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AACA;AACA;;;AAGI,sBAAc;AAAA;;AACV,aAAKA,KAAL,GAAa,EAAb;AACH;;;;8BAEK;AACF,mBAAO,KAAKA,KAAZ;AACH;;;4BAEGC,I,EAAMC,M,EAAQ;AACd,gBAAIC,MAAM,IAAV;AACA,iBAAK,IAAIC,GAAT,IAAgB,KAAKJ,KAArB,EAA4B;AACxB,oBAAIC,QAAQG,GAAZ,EAAiB;AACb,yBAAKJ,KAAL,CAAWI,GAAX,EAAgBC,IAAhB,CAAqBH,MAArB;AACAC,0BAAM,KAAN;AACH;AACJ;AACD,gBAAIA,GAAJ,EAAS;AACL,qBAAKH,KAAL,CAAWC,IAAX,IAAmB,CAACC,MAAD,CAAnB;AACH;;AAED,mBAAO,KAAKI,GAAL,EAAP;AACH;;;4BAEGL,I,EAAM;AACN,iBAAK,IAAIG,GAAT,IAAgB,KAAKJ,KAArB,EAA4B;AACxB,oBAAIC,QAAQG,GAAZ,EAAiB;AAAA;AAAA;AAAA;;AAAA;AACb,wEAAiB,KAAKJ,KAAL,CAAWI,GAAX,CAAjB,4GAAkC;AAAA,gCAAzBG,IAAyB;;AAC9B,gCAAI,aAAaC,IAAb,CAAkBD,IAAlB,CAAJ,EAA6B;AACzB,qCAAKE,WAAL,CAAiBF,IAAjB;AACH,6BAFD,MAEO;AACH,qCAAKG,aAAL,CAAmBH,IAAnB;AACH;AACJ;AAPY;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAQhB;AACJ;AACJ;;;sCAEaA,I,EAAM;AAChB,gBAAIL,SAASK,KAAKI,KAAL,CAAWJ,KAAKK,WAAL,CAAiB,GAAjB,CAAX,CAAb;AACAL,mBAAOA,KAAKI,KAAL,CAAW,CAAX,EAAcJ,KAAKK,WAAL,CAAiB,GAAjB,CAAd,CAAP;;AAEA,gBAAIC,UAAU,KAAd;AACA,iBAAK,IAAIC,IAAT,IAAiBC,OAAOC,WAAxB,EAAqC;AACjC,oBAAIF,QAAQP,IAAZ,EAAkB;AACdM,8BAAU,IAAV;AACA;AACH;AACJ;;AAED,gBAAIA,OAAJ,EAAa;AACT,oBAAII,OAAOF,OAAOC,WAAP,CAAmBT,IAAnB,CAAX;AACA,oBAAIW,OAAO,mCAA2BD,KAAKE,SAAhC,EAA2CC,MAA3C,CAAkD,UAASC,KAAT,EAAgB;AACzE,wBAAIA,SAAS,aAAb,EAA4B;AACxB,+BAAO,KAAP;AACH;AACD,2BAAO,IAAP;AACH,iBALU,CAAX;;AAOA,oBAAIC,WAAW,IAAf;AACA,qBAAK,IAAIC,CAAT,IAAcL,IAAd,EAAoB;AAChB,wBAAI,MAAMA,KAAKK,CAAL,CAAN,IAAiBrB,MAArB,EAA6B;AACzB,sDAAsB,IAAIe,IAAJ,EAAtB,EAAkCC,KAAKK,CAAL,CAAlC,EAA2CC,IAA3C,CAAgD,IAAhD;AACAF,mCAAW,KAAX;AACH;AACJ;;AAED,oBAAIA,QAAJ,EAAc;AACVG,4BAAQC,KAAR,CAAc,uBAAd;AACH;AACJ,aApBD,MAoBO;AACHD,wBAAQC,KAAR,CAAc,2BAAd;AACH;AACJ;;;oCAEWL,K,EAAO;AACfM,mCAAqBN,KAArB;AACH","file":"hook.class.js","sourcesContent":["// hooks 定义\n// {\n//     addOrder: [\n//         '/admin/index/index'\n//     ]\n// }\n\nexport default class {\n    constructor() {\n        this.hooks = {};\n    }\n\n    get() {\n        return this.hooks;\n    }\n\n    add(name, action) {\n        let add = true;\n        for (let key in this.hooks) {\n            if (name == key) {\n                this.hooks[key].push(action);\n                add = false;\n            }\n        }\n        if (add) {\n            this.hooks[name] = [action];\n        }\n\n        return this.get();\n    }\n\n    run(name) {\n        for (let key in this.hooks) {\n            if (name == key) {\n                for (let path of this.hooks[key]) {\n                    if (/\\w+\\(.*\\)$/.test(path)) {\n                        this.runFunction(path);\n                    } else {\n                        this.runController(path);\n                    }\n                }\n            }\n        }\n    }\n\n    runController(path) {\n        let action = path.slice(path.lastIndexOf('/'));\n        path = path.slice(0, path.lastIndexOf('/'));\n\n        let include = false;\n        for (let _key in koahub.controllers) {\n            if (_key == path) {\n                include = true;\n                break;\n            }\n        }\n\n        if (include) {\n            let ctrl = koahub.controllers[path];\n            let pros = Object.getOwnPropertyNames(ctrl.prototype).filter(function(value) {\n                if (value == 'constructor') {\n                    return false;\n                }\n                return true;\n            });\n\n            let callFlag = true;\n            for (let k in pros) {\n                if ('/' + pros[k] == action) {\n                    Object.getPrototypeOf(new ctrl())[pros[k]].call(this);\n                    callFlag = false;\n                }\n            }\n\n            if (callFlag) {\n                console.error('Hook Not Found Method');\n            }\n        } else {\n            console.error('Hook Not Found Controller');\n        }\n    }\n\n    runFunction(value) {\n        eval(`koahub.utils.${value}`);\n    }\n}\n"]}