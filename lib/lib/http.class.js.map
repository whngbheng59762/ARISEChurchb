{"version":3,"sources":["../../src/lib/http.class.js"],"names":["fs","path","runAction","constructor","ctx","next","arguments","length","Error","method","isGet","isPost","isAjax","header","isPjax","isMethod","toUpperCase","ip","name","value","get","set","status","code","query","post","file","session","cookie","options","cookies","state","host","redirect","url","download","filename","relative","dirname","view","createReadStream","action","args","Object","assign","data","body","json","msg","success","error","render","tpl","locals"],"mappings":"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","file":"http.class.js","sourcesContent":["import fs from \"fs\";\nimport path from \"path\";\nimport {runAction} from \"./../util/http.util\";\n\nexport default class {\n\n    constructor(ctx, next) {\n\n        if (arguments.length == 0) {\n            throw new Error('SyntaxError: missing super(ctx) call in constructor');\n            return;\n        }\n        if (arguments.length == 1) {\n            throw new Error('SyntaxError: missing super(next) call in constructor');\n            return;\n        }\n        this.ctx = ctx;\n        this.next = next;\n    }\n\n    method() {\n        return this.ctx.method;\n    }\n\n    isGet() {\n\n        if (this.ctx.method == 'GET') {\n            return true;\n        }\n        return false;\n    }\n\n    isPost() {\n\n        if (this.ctx.method == 'POST') {\n            return true;\n        }\n        return false;\n    }\n\n    isAjax() {\n        return this.header('X-Requested-With') === 'XMLHttpRequest';\n    }\n\n    isPjax() {\n        return this.header('X-PJAX') || false;\n    }\n\n    isMethod(method) {\n        return this.ctx.method === method.toUpperCase();\n    }\n\n    ip() {\n        return this.ctx.ip;\n    }\n\n    header(name, value) {\n\n        switch (arguments.length) {\n            case 1:\n                return this.ctx.get(name);\n            case 2:\n                this.ctx.set(name, value);\n        }\n    }\n\n    status(code) {\n\n        switch (arguments.length) {\n            case 0:\n                return this.ctx.status;\n            case 1:\n                this.ctx.status = code;\n        }\n    }\n\n    get(name, value) {\n\n        switch (arguments.length) {\n            case 0:\n                return this.ctx.query;\n            case 1:\n\n                if (name == null) {\n                    this.ctx.query = {};\n                    break;\n                }\n                return this.ctx.query[name];\n            case 2:\n\n                if (value == null) {\n                    delete this.ctx.query[name];\n                    break;\n                }\n                this.ctx.query[name] = value;\n        }\n    }\n\n    post(name, value) {\n\n        switch (arguments.length) {\n            case 0:\n                return this.ctx.post;\n            case 1:\n\n                if (name == null) {\n                    this.ctx.post = {};\n                    break;\n                }\n                return this.ctx.post[name];\n            case 2:\n\n                if (value == null) {\n                    delete this.ctx.post[name];\n                    break;\n                }\n                this.ctx.post[name] = value;\n        }\n    }\n\n    file(name, value) {\n\n        switch (arguments.length) {\n            case 0:\n                return this.ctx.file;\n            case 1:\n\n                if (name == null) {\n                    this.ctx.file = {};\n                    break;\n                }\n                return this.ctx.file[name];\n            case 2:\n\n                if (value == null) {\n                    delete this.ctx.file[name];\n                    break;\n                }\n                this.ctx.file[name] = value;\n        }\n    }\n\n    session(name, value) {\n\n        switch (arguments.length) {\n            case 0:\n                return this.ctx.session;\n            case 1:\n\n                if (name == null) {\n                    this.ctx.session = {};\n                    break;\n                }\n                return this.ctx.session[name];\n            case 2:\n\n                if (value == null) {\n                    delete this.ctx.session[name];\n                    break;\n                }\n                this.ctx.session[name] = value;\n        }\n    }\n\n    cookie() {\n\n        return {\n            get: function (name, options) {\n                return this.ctx.cookies.get(name, options);\n            },\n            set: function (name, value, options) {\n                return this.ctx.cookies.set(name, value, options);\n            }\n        }\n    }\n\n    state(name, value) {\n\n        switch (arguments.length) {\n            case 0:\n                return this.ctx.state;\n            case 1:\n\n                if (name == null) {\n                    this.ctx.state = {};\n                    break;\n                }\n                return this.ctx.state[name];\n            case 2:\n\n                if (value == null) {\n                    delete this.ctx.state[name];\n                    break;\n                }\n                this.ctx.state[name] = value;\n        }\n    }\n\n    host() {\n        return this.ctx.host;\n    }\n\n    redirect(url) {\n        this.ctx.redirect(url);\n    }\n\n    download(file) {\n\n        const filename = path.relative(path.dirname(file), file);\n\n        this.header('Content-disposition', 'attachment; filename=' + filename);\n        this.view(fs.createReadStream(file));\n    }\n\n    async action(path, ...args) {\n        return await runAction(Object.assign(this.ctx, {path: path}), this.next, ...args);\n    }\n\n    view(data) {\n        this.ctx.body = data;\n    }\n\n    json(data, msg, code) {\n\n        let body = {};\n\n        switch (arguments.length) {\n            case 1:\n                body = {\n                    data: data,\n                }\n                break;\n            case 2:\n                body = {\n                    data: data,\n                    msg: msg,\n                }\n                break;\n            case 3:\n                body = {\n                    data: data,\n                    msg: msg,\n                    code: code\n                }\n                break;\n        }\n\n        this.ctx.body = body;\n    }\n\n    success(data, msg) {\n        this.json(data, msg, 1);\n    }\n\n    error(data, msg) {\n        this.json(data, msg, 0);\n    }\n\n    async render(tpl, locals) {\n        await this.ctx.render(tpl, locals);\n    }\n}\n"]}