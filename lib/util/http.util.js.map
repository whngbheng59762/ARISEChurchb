{"version":3,"sources":["../../src/util/http.util.js"],"names":["runAction","getAllModules","getModuleControllerAction","path","_throw","module","controller","action","modules","koahub","utils","lodash","includes","ctx","throw","console","error","ctrl","controllers","_ctrl","methods","prototype","filter","value","err","key","push","split","union","paths","substr","length","configs","index","default_module","default_controller","default_action"],"mappings":"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","file":"http.util.js","sourcesContent":["// run module/controller/action\nexport function runAction(path, _throw = false) {\n\n    const {module, controller, action} = getModuleControllerAction(path);\n\n    const modules = getAllModules();\n    if (!koahub.utils.lodash.includes(modules, module)) {\n        if (_throw) {\n            ctx.throw(404, 'Not Found Module');\n        } else {\n            console.error('Not Found Module');\n        }\n        return;\n    }\n\n    const ctrl = koahub.controllers[`/${module}/${controller}`];\n    if (ctrl) {\n\n        const _ctrl = new ctrl();\n        const methods = Object.getOwnPropertyNames(ctrl.prototype).filter(function (value) {\n            return value !== 'constructor';\n        });\n\n        if (koahub.utils.lodash.includes(methods, action)) {\n\n            try {\n                _ctrl[action](this);\n            } catch (err) {\n                throw err;\n            }\n        } else {\n            if (_throw) {\n                ctx.throw(404, 'Not Found Action');\n            } else {\n                console.error('Not Found Action');\n            }\n        }\n    } else {\n\n        if (_throw) {\n            ctx.throw(404, 'Not Found Controller');\n        } else {\n            console.error('Not Found Controller');\n        }\n    }\n}\n\n// get all modules\nexport function getAllModules() {\n\n    let modules = [];\n    for (let key in koahub.controllers) {\n        modules.push(key.split('/')[1]);\n    }\n    modules = koahub.utils.lodash.union(modules);\n    return modules;\n}\n\n// get module controller action\nexport function getModuleControllerAction(path) {\n\n    let paths = [];\n    if (path != '/') {\n        paths = path.substr(1, path.length).split('/');\n    }\n\n    let module = koahub.configs.index.default_module;\n    let controller = koahub.configs.index.default_controller;\n    let action = koahub.configs.index.default_action;\n\n    switch (paths.length) {\n        case 0:\n\n            break;\n        case 1:\n\n            module = paths[0];\n            break;\n        case 2:\n\n            module = paths[0];\n            controller = paths[1];\n            break;\n        case 3:\n\n            module = paths[0];\n            controller = paths[1];\n            action = paths[2];\n            break;\n        default:\n\n            module = paths[0];\n            controller = '';\n            for (var key in paths) {\n                if (key > 0 && key < paths.length - 1) {\n                    if (key == paths.length - 2) {\n                        controller += paths[key];\n                        break;\n                    }\n                    controller += paths[key] + '/';\n                }\n            }\n            action = paths[paths.length - 1];\n    }\n\n    return {\n        module: module,\n        controller: controller,\n        action: action\n    }\n}"]}