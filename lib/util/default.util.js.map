{"version":3,"sources":["../../src/util/default.util.js"],"names":["runAction","path","paths","split","action","length","module","_path","slice","lastIndexOf","include","modules","key","koahub","controllers","_module","push","utils","lodash","union","controller","property","prototype","filter","value","k","call","ctx","throw","redirect","includes","configs","default","default_module","default_controller","default_action"],"mappings":";;;;;;;;;;;;;;QACgBA,S,GAAAA,S;;;;AADhB;AACO,SAASA,SAAT,CAAmBC,IAAnB,EAAyB;;AAE5B,QAAMC,QAAQD,KAAKE,KAAL,CAAW,GAAX,CAAd;AACA,QAAMC,SAASF,MAAMA,MAAMG,MAAN,GAAe,CAArB,CAAf;AACA,QAAMC,SAASJ,MAAM,CAAN,CAAf;AACA,QAAMK,QAAQN,KAAKO,KAAL,CAAW,CAAX,EAAcP,KAAKQ,WAAL,CAAiB,GAAjB,CAAd,CAAd;;AAEA,QAAIC,UAAU,KAAd;AACA,QAAIC,UAAU,EAAd;AACA,SAAK,IAAIC,GAAT,IAAgBC,OAAOC,WAAvB,EAAoC;AAChC,YAAIF,OAAOL,KAAX,EAAkB;AACdG,sBAAU,IAAV;AACH;;AAED,YAAIK,UAAUH,IAAIT,KAAJ,CAAU,GAAV,EAAe,CAAf,CAAd;AACAQ,gBAAQK,IAAR,CAAaD,OAAb;AACH;AACDJ,cAAUE,OAAOI,KAAP,CAAaC,MAAb,CAAoBC,KAApB,CAA0BR,OAA1B,CAAV;;AAEA,QAAID,OAAJ,EAAa;AACT,YAAIU,aAAaP,OAAOC,WAAP,CAAmBP,KAAnB,CAAjB;AACA,YAAIc,WAAW,mCAA2BD,WAAWE,SAAtC,EAAiDC,MAAjD,CAAwD,UAAUC,KAAV,EAAiB;AACpF,gBAAIA,SAAS,aAAb,EAA4B;AACxB,uBAAO,KAAP;AACH;AACD,mBAAO,IAAP;AACH,SALc,CAAf;;AAOA,aAAK,IAAIC,CAAT,IAAcJ,QAAd,EAAwB;AACpB,gBAAIA,SAASI,CAAT,KAAerB,MAAnB,EAA2B;AACvB,8CAAsB,IAAIgB,UAAJ,EAAtB,EAAwCC,SAASI,CAAT,CAAxC,EAAqDC,IAArD,CAA0D,IAA1D;AACA;AACH;AACJ;;AAED,YAAOnB,KAAH,eAAoBN,IAAxB,EAA8B;AAC1B0B,gBAAIC,KAAJ,CAAU,GAAV,EAAe,kBAAf;AACA;AACH;AACDD,YAAIE,QAAJ,CAAgBtB,KAAhB;AACH,KArBD,MAqBO;;AAEH,YAAID,UAAU,CAACO,OAAOI,KAAP,CAAaC,MAAb,CAAoBY,QAApB,CAA6BnB,OAA7B,EAAsCL,MAAtC,CAAf,EAA8D;AAC1DqB,gBAAIC,KAAJ,CAAU,GAAV,EAAe,kBAAf;AACA;AACH;;AAED,YAAI,CAACtB,MAAD,IAAWA,UAAUO,OAAOkB,OAAP,CAAeC,OAAf,CAAuBC,cAAhD,EAAgE;AAC5DN,gBAAIE,QAAJ,OAAiBhB,OAAOkB,OAAP,CAAeC,OAAf,CAAuBC,cAAxC,SAA0DpB,OAAOkB,OAAP,CAAeC,OAAf,CAAuBE,kBAAjF,SAAuGrB,OAAOkB,OAAP,CAAeC,OAAf,CAAuBG,cAA9H;AACH,SAFD,MAEO;AACHR,gBAAIE,QAAJ,OAAiBvB,MAAjB,SAA2BO,OAAOkB,OAAP,CAAeC,OAAf,CAAuBE,kBAAlD,SAAwErB,OAAOkB,OAAP,CAAeC,OAAf,CAAuBG,cAA/F;AACH;AACJ;AACJ","file":"default.util.js","sourcesContent":["// run module/controller/action\nexport function runAction(path) {\n\n    const paths = path.split('/');\n    const action = paths[paths.length - 1];\n    const module = paths[1];\n    const _path = path.slice(0, path.lastIndexOf('/'));\n\n    let include = false;\n    let modules = [];\n    for (let key in koahub.controllers) {\n        if (key == _path) {\n            include = true;\n        }\n\n        let _module = key.split('/')[1];\n        modules.push(_module);\n    }\n    modules = koahub.utils.lodash.union(modules);\n\n    if (include) {\n        let controller = koahub.controllers[_path];\n        let property = Object.getOwnPropertyNames(controller.prototype).filter(function (value) {\n            if (value == 'constructor') {\n                return false;\n            }\n            return true;\n        });\n\n        for (let k in property) {\n            if (property[k] == action) {\n                Object.getPrototypeOf(new controller())[property[k]].call(this);\n                return;\n            }\n        }\n\n        if (`${_path}/index` == path) {\n            ctx.throw(404, 'Not Found Action');\n            return;\n        }\n        ctx.redirect(`${_path}/index`);\n    } else {\n\n        if (module && !koahub.utils.lodash.includes(modules, module)) {\n            ctx.throw(404, 'Not Found Module');\n            return;\n        }\n\n        if (!module || module == koahub.configs.default.default_module) {\n            ctx.redirect(`/${koahub.configs.default.default_module}/${koahub.configs.default.default_controller}/${koahub.configs.default.default_action}`);\n        } else {\n            ctx.redirect(`/${module}/${koahub.configs.default.default_controller}/${koahub.configs.default.default_action}`);\n        }\n    }\n}"]}