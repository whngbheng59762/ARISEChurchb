{"version":3,"sources":["../../src/util/default.util.js"],"names":["runAction","getAllModules","getModuleControllerAction","path","_throw","module","controller","action","ctrl","koahub","controllers","property","prototype","filter","value","k","call","ctx","throw","console","error","modules","key","push","split","utils","lodash","union","paths","substr","length","configs","default","default_module","default_controller","default_action"],"mappings":"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","file":"default.util.js","sourcesContent":["// run module/controller/action\nexport function runAction(path, _throw = false) {\n\n    let {module, controller, action} = getModuleControllerAction(path);\n\n    let ctrl = koahub.controllers[`/${module}/${controller}`];\n    if (ctrl) {\n        let property = Object.getOwnPropertyNames(ctrl.prototype).filter(function (value) {\n            if (value == 'constructor') {\n                return false;\n            }\n            return true;\n        });\n\n        for (let k in property) {\n            if (property[k] == action) {\n                Object.getPrototypeOf(new ctrl())[property[k]].call(this);\n                return;\n            }\n        }\n\n        if (_throw) {\n            ctx.throw(404, 'Not Found Action');\n        } else {\n            console.error('Not Found Action');\n        }\n    } else {\n\n        if (_throw) {\n            ctx.throw(404, 'Not Found Controller');\n        } else {\n            console.error('Not Found Controller');\n        }\n    }\n}\n\n// get all modules\nexport function getAllModules() {\n\n    let modules = [];\n    for (let key in koahub.controllers) {\n        modules.push(key.split('/')[1]);\n    }\n    modules = koahub.utils.lodash.union(modules);\n    return modules;\n}\n\n// get module controller action\nexport function getModuleControllerAction(path) {\n\n    let paths = [];\n    if (path != '/') {\n        paths = path.substr(1, path.length).split('/');\n        for (var key in paths) {\n            if (!paths[key]) {\n                ctx.throw(403, 'The url is error');\n                return;\n            }\n        }\n    }\n\n    let module = koahub.configs.default.default_module;\n    let controller = koahub.configs.default.default_controller;\n    let action = koahub.configs.default.default_action;\n\n    switch (paths.length) {\n        case 0:\n\n            break;\n        case 1:\n\n            module = paths[0];\n            break;\n        case 2:\n\n            module = paths[0];\n            controller = paths[1];\n            break;\n        case 3:\n\n            module = paths[0];\n            controller = paths[1];\n            action = paths[2];\n            break;\n        default:\n\n            module = paths[0];\n            controller = '';\n            for (var key in paths) {\n                if (key > 0 && key < paths.length - 1) {\n                    if (key == paths.length - 2) {\n                        controller += paths[key];\n                        break;\n                    }\n                    controller += paths[key] + '/';\n                }\n            }\n            action = paths[paths.length - 1];\n    }\n\n    return {\n        module: module,\n        controller: controller,\n        action: action\n    }\n}"]}