{"version":3,"sources":["../../src/util/default.util.js"],"names":["runAction","path","paths","split","action","length","module","_path","slice","lastIndexOf","include","key","koahub","controllers","controller","property","prototype","filter","value","k","call","ctx","throw","redirect","configs","default","default_module","default_controller","default_action"],"mappings":";;;;;;;;;;;;;;QACgBA,S,GAAAA,S;;;;AADhB;AACO,SAASA,SAAT,CAAmBC,IAAnB,EAAyB;;AAE5B,QAAMC,QAAQD,KAAKE,KAAL,CAAW,GAAX,CAAd;AACA,QAAMC,SAASF,MAAMA,MAAMG,MAAN,GAAe,CAArB,CAAf;AACA,QAAMC,SAASJ,MAAM,CAAN,CAAf;AACA,QAAMK,QAAQN,KAAKO,KAAL,CAAW,CAAX,EAAcP,KAAKQ,WAAL,CAAiB,GAAjB,CAAd,CAAd;;AAEA,QAAIC,UAAU,KAAd;AACA,SAAK,IAAIC,GAAT,IAAgBC,OAAOC,WAAvB,EAAoC;AAChC,YAAIF,OAAOJ,KAAX,EAAkB;AACdG,sBAAU,IAAV;AACA;AACH;AACJ;;AAED,QAAIA,OAAJ,EAAa;AACT,YAAII,aAAaF,OAAOC,WAAP,CAAmBN,KAAnB,CAAjB;AACA,YAAIQ,WAAW,mCAA2BD,WAAWE,SAAtC,EAAiDC,MAAjD,CAAwD,UAAUC,KAAV,EAAiB;AACpF,gBAAIA,SAAS,aAAb,EAA4B;AACxB,uBAAO,KAAP;AACH;AACD,mBAAO,IAAP;AACH,SALc,CAAf;;AAOA,aAAK,IAAIC,CAAT,IAAcJ,QAAd,EAAwB;AACpB,gBAAIA,SAASI,CAAT,KAAef,MAAnB,EAA2B;AACvB,8CAAsB,IAAIU,UAAJ,EAAtB,EAAwCC,SAASI,CAAT,CAAxC,EAAqDC,IAArD,CAA0D,IAA1D;AACA;AACH;AACJ;;AAED,YAAOb,KAAH,eAAoBN,IAAxB,EAA8B;AAC1BoB,gBAAIC,KAAJ,CAAU,GAAV,EAAe,kBAAf;AACA;AACH;AACDD,YAAIE,QAAJ,CAAgBhB,KAAhB;AACH,KArBD,MAqBO;;AAEH,YAAI,CAACD,MAAD,IAAWA,UAAUM,OAAOY,OAAP,CAAeC,OAAf,CAAuBC,cAAhD,EAAgE;AAC5DL,gBAAIE,QAAJ,OAAiBX,OAAOY,OAAP,CAAeC,OAAf,CAAuBC,cAAxC,SAA0Dd,OAAOY,OAAP,CAAeC,OAAf,CAAuBE,kBAAjF,SAAuGf,OAAOY,OAAP,CAAeC,OAAf,CAAuBG,cAA9H;AACH,SAFD,MAEO;AACHP,gBAAIE,QAAJ,OAAiBjB,MAAjB,SAA2BM,OAAOY,OAAP,CAAeC,OAAf,CAAuBE,kBAAlD,SAAwEf,OAAOY,OAAP,CAAeC,OAAf,CAAuBG,cAA/F;AACH;AACJ;AACJ","file":"default.util.js","sourcesContent":["// run module/controller/action\nexport function runAction(path) {\n\n    const paths = path.split('/');\n    const action = paths[paths.length - 1];\n    const module = paths[1];\n    const _path = path.slice(0, path.lastIndexOf('/'));\n\n    let include = false;\n    for (let key in koahub.controllers) {\n        if (key == _path) {\n            include = true;\n            break;\n        }\n    }\n\n    if (include) {\n        let controller = koahub.controllers[_path];\n        let property = Object.getOwnPropertyNames(controller.prototype).filter(function (value) {\n            if (value == 'constructor') {\n                return false;\n            }\n            return true;\n        });\n\n        for (let k in property) {\n            if (property[k] == action) {\n                Object.getPrototypeOf(new controller())[property[k]].call(this);\n                return;\n            }\n        }\n\n        if (`${_path}/index` == path) {\n            ctx.throw(404, 'Not Found Action');\n            return;\n        }\n        ctx.redirect(`${_path}/index`);\n    } else {\n\n        if (!module || module == koahub.configs.default.default_module) {\n            ctx.redirect(`/${koahub.configs.default.default_module}/${koahub.configs.default.default_controller}/${koahub.configs.default.default_action}`);\n        } else {\n            ctx.redirect(`/${module}/${koahub.configs.default.default_controller}/${koahub.configs.default.default_action}`);\n        }\n    }\n}"]}