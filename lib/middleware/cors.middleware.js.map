{"version":3,"sources":["../../src/middleware/cors.middleware.js"],"names":["options","defaults","origin","methods","key","hasOwnProperty","Array","isArray","expose","join","maxAge","toString","headers","ctx","next","get","request","set","credentials","method","status","cors"],"mappings":"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","file":"cors.middleware.js","sourcesContent":["export default function (options) {\n\n    options = options || {};\n\n    const defaults = {\n        origin: true,\n        methods: 'GET,HEAD,PUT,POST,DELETE'\n    };\n\n    // Set defaults\n    for (let key in defaults) {\n        if (!options.hasOwnProperty(key)) {\n            options[key] = defaults[key];\n        }\n    }\n\n    // Set expose\n    if (Array.isArray(options.expose)) {\n        options.expose = options.expose.join(',');\n    }\n\n    // Set maxAge\n    if (typeof options.maxAge === 'number') {\n        options.maxAge = options.maxAge.toString();\n    } else {\n        options.maxAge = null;\n    }\n\n    // Set methods\n    if (Array.isArray(options.methods)) {\n        options.methods = options.methods.join(',');\n    }\n\n    // Set headers\n    if (Array.isArray(options.headers)) {\n        options.headers = options.headers.join(',');\n    }\n\n    return async function cors(ctx, next) {\n\n        /**\n         * Access Control Allow Origin\n         */\n        let origin;\n\n        if (typeof options.origin === 'string') {\n            origin = options.origin;\n        } else if (options.origin === true) {\n            origin = ctx.get('origin') || '*';\n        } else if (options.origin === false) {\n            origin = options.origin;\n        } else if (typeof options.origin === 'function') {\n            origin = options.origin(ctx.request);\n        }\n\n        if (origin === false) return;\n\n        ctx.set('Access-Control-Allow-Origin', origin);\n\n        /**\n         * Access Control Expose Headers\n         */\n        if (options.expose) {\n            ctx.set('Access-Control-Expose-Headers', options.expose);\n        }\n\n        /**\n         * Access Control Max Age\n         */\n        if (options.maxAge) {\n            ctx.set('Access-Control-Max-Age', options.maxAge);\n        }\n\n        /**\n         * Access Control Allow Credentials\n         */\n        if (options.credentials === true) {\n            ctx.set('Access-Control-Allow-Credentials', 'true');\n        }\n\n        /**\n         * Access Control Allow Methods\n         */\n        ctx.set('Access-Control-Allow-Methods', options.methods);\n\n        /**\n         * Access Control Allow Headers\n         */\n        let headers;\n\n        if (options.headers) {\n            headers = options.headers;\n        } else {\n            headers = ctx.get('access-control-request-headers');\n        }\n\n        if (headers) {\n            ctx.set('Access-Control-Allow-Headers', headers);\n        }\n\n        /**\n         * Returns\n         */\n        if (ctx.method === 'OPTIONS') {\n            ctx.status = 204;\n        } else {\n            await next();\n        }\n    };\n}"]}