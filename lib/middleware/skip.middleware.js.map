{"version":3,"sources":["../../src/middleware/skip.middleware.js"],"names":["options","parent","opts","custom","useOriginalUrl","ship","ctx","next","requestedUrl","parse","originalUrl","url","skip","paths","path","Array","isArray","some","p","pathname","RegExp","exec","exts","ext","substr","length","methods","method","indexOf"],"mappings":";;;;;;kBAEe,UAAUA,OAAV,EAAmB;AAC9B,QAAMC,SAAS,IAAf;;AAEA,QAAMC,OAAO,OAAOF,OAAP,KAAmB,UAAnB,GAAgC,EAACG,QAAQH,OAAT,EAAhC,GAAoDA,OAAjE;AACAE,SAAKE,cAAL,GAAuB,OAAOF,KAAKE,cAAZ,KAA+B,WAAhC,GAA+C,IAA/C,GAAsDF,KAAKE,cAAjF;;AAEA,WAAO,SAASC,IAAT,CAAeC,GAAf,EAAoBC,IAApB,EAA0B;AAC7B,YAAMC,eAAe,cAAIC,KAAJ,CAAU,CAACP,KAAKE,cAAL,GAAsBE,IAAII,WAA1B,GAAwCJ,IAAIK,GAA7C,KAAqD,EAA/D,EAAmE,IAAnE,CAArB;;AAEA,YAAIC,OAAO,KAAX;;AAEA,YAAIV,KAAKC,MAAT,EAAiB;AACbS,mBAAOA,QAAQV,KAAKC,MAAL,CAAYG,GAAZ,CAAf;AACH;;AAED,YAAMO,QAAQ,CAACX,KAAKY,IAAN,IAAcC,MAAMC,OAAN,CAAcd,KAAKY,IAAnB,CAAd,GACVZ,KAAKY,IADK,GACE,CAACZ,KAAKY,IAAN,CADhB;;AAGA,YAAID,KAAJ,EAAW;AACPD,mBAAOA,QAAQC,MAAMI,IAAN,CAAW,UAAUC,CAAV,EAAa;AAC/B,uBAAQ,OAAOA,CAAP,KAAa,QAAb,IAAyBA,MAAMV,aAAaW,QAA7C,IACFD,aAAaE,MAAb,IAAuB,CAAC,CAACF,EAAEG,IAAF,CAAOb,aAAaW,QAApB,CAD9B;AAEH,aAHU,CAAf;AAIH;;AAED,YAAMG,OAAO,CAACpB,KAAKqB,GAAN,IAAaR,MAAMC,OAAN,CAAcd,KAAKqB,GAAnB,CAAb,GACTrB,KAAKqB,GADI,GACE,CAACrB,KAAKqB,GAAN,CADf;;AAGA,YAAID,IAAJ,EAAU;AACNV,mBAAOA,QAAQU,KAAKL,IAAL,CAAU,UAAUM,GAAV,EAAe;AAChC,uBAAOf,aAAaW,QAAb,CAAsBK,MAAtB,CAA6BD,IAAIE,MAAJ,GAAa,CAAC,CAA3C,MAAkDF,GAAzD;AACH,aAFU,CAAf;AAGH;;AAED,YAAMG,UAAU,CAACxB,KAAKyB,MAAN,IAAgBZ,MAAMC,OAAN,CAAcd,KAAKyB,MAAnB,CAAhB,GACZzB,KAAKyB,MADO,GACE,CAACzB,KAAKyB,MAAN,CADlB;;AAGA,YAAID,OAAJ,EAAa;AACTd,mBAAOA,QAAQ,CAAC,CAAC,CAACc,QAAQE,OAAR,CAAgBtB,IAAIqB,MAApB,CAAlB;AACH;;AAED,YAAIf,IAAJ,EAAU;AACN,mBAAOL,MAAP;AACH;;AAED,eAAON,OAAOK,GAAP,EAAYC,IAAZ,CAAP;AACH,KAxCD;AAyCH,C;;AAjDD","file":"skip.middleware.js","sourcesContent":["import url from \"url\";\n\nexport default function (options) {\n    const parent = this;\n\n    const opts = typeof options === 'function' ? {custom: options} : options;\n    opts.useOriginalUrl = (typeof opts.useOriginalUrl === 'undefined') ? true : opts.useOriginalUrl;\n\n    return function ship (ctx, next) {\n        const requestedUrl = url.parse((opts.useOriginalUrl ? ctx.originalUrl : ctx.url) || '', true);\n\n        let skip = false;\n\n        if (opts.custom) {\n            skip = skip || opts.custom(ctx);\n        }\n\n        const paths = !opts.path || Array.isArray(opts.path) ?\n            opts.path : [opts.path];\n\n        if (paths) {\n            skip = skip || paths.some(function (p) {\n                    return (typeof p === 'string' && p === requestedUrl.pathname) ||\n                        (p instanceof RegExp && !!p.exec(requestedUrl.pathname));\n                });\n        }\n\n        const exts = !opts.ext || Array.isArray(opts.ext) ?\n            opts.ext : [opts.ext];\n\n        if (exts) {\n            skip = skip || exts.some(function (ext) {\n                    return requestedUrl.pathname.substr(ext.length * -1) === ext;\n                });\n        }\n\n        const methods = !opts.method || Array.isArray(opts.method) ?\n            opts.method : [opts.method];\n\n        if (methods) {\n            skip = skip || !!~methods.indexOf(ctx.method);\n        }\n\n        if (skip) {\n            return next();\n        }\n\n        return parent(ctx, next);\n    };\n}"]}