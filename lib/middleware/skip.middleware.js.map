{"version":3,"sources":["../../src/middleware/skip.middleware.js"],"names":["url","options","parent","opts","custom","useOriginalUrl","ctx","next","requestedUrl","parse","originalUrl","skip","paths","path","Array","isArray","some","p","pathname","RegExp","exec","exts","ext","substr","length","methods","method","indexOf"],"mappings":"AAAA,OAAOA,GAAP,MAAgB,KAAhB;;AAEA,eAAe,UAAUC,OAAV,EAAmB;AAC9B,UAAMC,SAAS,IAAf;;AAEA,UAAMC,OAAO,OAAOF,OAAP,KAAmB,UAAnB,GAAgC,EAACG,QAAQH,OAAT,EAAhC,GAAoDA,OAAjE;AACAE,SAAKE,cAAL,GAAuB,OAAOF,KAAKE,cAAZ,KAA+B,WAAhC,GAA+C,IAA/C,GAAsDF,KAAKE,cAAjF;;AAEA,WAAO,UAAUC,GAAV,EAAeC,IAAf,EAAqB;AACxB,cAAMC,eAAeR,IAAIS,KAAJ,CAAU,CAACN,KAAKE,cAAL,GAAsBC,IAAII,WAA1B,GAAwCJ,IAAIN,GAA7C,KAAqD,EAA/D,EAAmE,IAAnE,CAArB;;AAEA,YAAIW,OAAO,KAAX;;AAEA,YAAIR,KAAKC,MAAT,EAAiB;AACbO,mBAAOA,QAAQR,KAAKC,MAAL,CAAYE,GAAZ,CAAf;AACH;;AAED,cAAMM,QAAQ,CAACT,KAAKU,IAAN,IAAcC,MAAMC,OAAN,CAAcZ,KAAKU,IAAnB,CAAd,GACVV,KAAKU,IADK,GACE,CAACV,KAAKU,IAAN,CADhB;;AAGA,YAAID,KAAJ,EAAW;AACPD,mBAAOA,QAAQC,MAAMI,IAAN,CAAW,UAAUC,CAAV,EAAa;AAC/B,uBAAQ,OAAOA,CAAP,KAAa,QAAb,IAAyBA,MAAMT,aAAaU,QAA7C,IACFD,aAAaE,MAAb,IAAuB,CAAC,CAACF,EAAEG,IAAF,CAAOZ,aAAaU,QAApB,CAD9B;AAEH,aAHU,CAAf;AAIH;;AAED,cAAMG,OAAO,CAAClB,KAAKmB,GAAN,IAAaR,MAAMC,OAAN,CAAcZ,KAAKmB,GAAnB,CAAb,GACTnB,KAAKmB,GADI,GACE,CAACnB,KAAKmB,GAAN,CADf;;AAGA,YAAID,IAAJ,EAAU;AACNV,mBAAOA,QAAQU,KAAKL,IAAL,CAAU,UAAUM,GAAV,EAAe;AAChC,uBAAOd,aAAaU,QAAb,CAAsBK,MAAtB,CAA6BD,IAAIE,MAAJ,GAAa,CAAC,CAA3C,MAAkDF,GAAzD;AACH,aAFU,CAAf;AAGH;;AAED,cAAMG,UAAU,CAACtB,KAAKuB,MAAN,IAAgBZ,MAAMC,OAAN,CAAcZ,KAAKuB,MAAnB,CAAhB,GACZvB,KAAKuB,MADO,GACE,CAACvB,KAAKuB,MAAN,CADlB;;AAGA,YAAID,OAAJ,EAAa;AACTd,mBAAOA,QAAQ,CAAC,CAAC,CAACc,QAAQE,OAAR,CAAgBrB,IAAIoB,MAApB,CAAlB;AACH;;AAED,YAAIf,IAAJ,EAAU;AACN,mBAAOJ,MAAP;AACH;;AAED,eAAOL,OAAOI,GAAP,EAAYC,IAAZ,CAAP;AACH,KAxCD;AAyCH","file":"skip.middleware.js","sourcesContent":["import url from \"url\";\n\nexport default function (options) {\n    const parent = this;\n\n    const opts = typeof options === 'function' ? {custom: options} : options;\n    opts.useOriginalUrl = (typeof opts.useOriginalUrl === 'undefined') ? true : opts.useOriginalUrl;\n\n    return function (ctx, next) {\n        const requestedUrl = url.parse((opts.useOriginalUrl ? ctx.originalUrl : ctx.url) || '', true);\n\n        let skip = false;\n\n        if (opts.custom) {\n            skip = skip || opts.custom(ctx);\n        }\n\n        const paths = !opts.path || Array.isArray(opts.path) ?\n            opts.path : [opts.path];\n\n        if (paths) {\n            skip = skip || paths.some(function (p) {\n                    return (typeof p === 'string' && p === requestedUrl.pathname) ||\n                        (p instanceof RegExp && !!p.exec(requestedUrl.pathname));\n                });\n        }\n\n        const exts = !opts.ext || Array.isArray(opts.ext) ?\n            opts.ext : [opts.ext];\n\n        if (exts) {\n            skip = skip || exts.some(function (ext) {\n                    return requestedUrl.pathname.substr(ext.length * -1) === ext;\n                });\n        }\n\n        const methods = !opts.method || Array.isArray(opts.method) ?\n            opts.method : [opts.method];\n\n        if (methods) {\n            skip = skip || !!~methods.indexOf(ctx.method);\n        }\n\n        if (skip) {\n            return next();\n        }\n\n        return parent(ctx, next);\n    };\n}"]}